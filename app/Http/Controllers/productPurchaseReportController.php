<?php
 namespace App\Http\Controllers; use App\Http\Controllers\Controller; use App\Models\accounts; use App\Models\products; use App\Models\purchase_details; use Illuminate\Http\Request; use Illuminate\Support\Facades\DB; class productPurchaseReportController extends Controller { public function index() { $vendors = accounts::company()->get(); return view("\x72\x65\160\157\162\x74\163\x2e\160\165\162\x63\150\141\163\x65\x2e\x69\x6e\144\145\x78", compact("\166\145\x6e\x64\157\x72\x73")); } public function data($from, $to, $vendor) { $vendor = accounts::find($vendor); $purchases = DB::table("\x70\165\162\x63\x68\141\x73\145\137\x64\145\x74\x61\x69\x6c\163\40\141\163\x20\x70\144")->join("\x70\x75\162\x63\150\x61\163\x65\163\40\141\x73\x20\x70", "\x70\56\151\144", "\75", "\160\144\x2e\x70\x75\x72\143\x68\141\163\145\111\104")->where("\x70\x2e\x76\145\156\144\x6f\x72\x49\x44", $vendor->id)->whereBetween("\x70\x2e\x64\x61\164\145", array($from, $to))->groupBy("\160\144\x2e\x70\x72\x6f\144\165\x63\x74\111\x44")->select("\x70\x64\x2e\x70\x72\157\144\x75\x63\164\111\x44", DB::raw("\122\117\125\x4e\104\x28\x41\126\107\50\x70\x64\56\x70\x70\162\151\143\145\x29\54\40\x32\51\40\x61\x73\40\141\x76\x67\x5f\160\x70\x72\151\143\x65"), DB::raw("\123\x55\x4d\50\x70\x64\x2e\161\x74\x79\51\x20\141\x73\x20\x74\x6f\164\141\x6c\x5f\x71\164\x79"))->get(); foreach ($purchases as $purchase) { $product = products::find($purchase->productID); $purchase->product_code = $product->code; $purchase->product = $product->name; $purchase->product_category = $product->category->name; $purchase->product_stock = getStock($product->id); } return view("\x72\x65\x70\x6f\162\164\163\56\160\165\x72\x63\150\x61\x73\145\x2e\144\145\164\141\x69\154\163", compact("\146\162\157\x6d", "\x74\x6f", "\166\x65\156\x64\157\162", "\160\x75\162\143\x68\141\x73\145\x73")); } }